asyncapi: "2.6.0"
info:
  title: ElevenLabs Scribe Contract
  version: "1.0.0"
  description: |
    Real-time speech-to-text transcription service.
    This WebSocket API enables streaming audio input and receiving transcription results.

    ## Event Flow
    - Audio chunks are sent as input_audio_chunk messages
    - Transcription results are streamed back in various formats (partial, committed, with timestamps)
    - Supports manual commit or VAD-based automatic commit strategies
  contact:
    name: ElevenLabs API Support
    url: https://elevenlabs.io/docs
    email: support@elevenlabs.io

servers:
  production:
    url: wss://api.elevenlabs.io
    protocol: ws
    description: Production WebSocket server (US/Global)
  eu-residency:
    url: wss://api.eu.residency.elevenlabs.io
    protocol: ws
    description: EU residency WebSocket server for GDPR compliance
  in-residency:
    url: wss://api.in.residency.elevenlabs.io
    protocol: ws
    description: India residency WebSocket server for data locality
  development:
    url: ws://localhost:8080
    protocol: ws
    description: Local development server

channels:
  ScribeMessages:
    description: Main WebSocket channel for real-time transcription
    publish:
      summary: Messages sent from server to client
      message:
        oneOf:
          # Server -> Client messages
          - $ref: "#/components/messages/SessionStarted"
          - $ref: "#/components/messages/PartialTranscript"
          - $ref: "#/components/messages/CommittedTranscript"
          - $ref: "#/components/messages/CommittedTranscriptWithTimestamps"
          - $ref: "#/components/messages/Error"
          - $ref: "#/components/messages/AuthError"
          - $ref: "#/components/messages/QuotaExceededError"
          - $ref: "#/components/messages/CommitThrottledError"
          - $ref: "#/components/messages/TranscriberError"
          - $ref: "#/components/messages/UnacceptedTermsError"
          - $ref: "#/components/messages/RateLimitedError"
          - $ref: "#/components/messages/InputError"
          - $ref: "#/components/messages/QueueOverflowError"
          - $ref: "#/components/messages/ResourceExhaustedError"
          - $ref: "#/components/messages/SessionTimeLimitExceededError"
          - $ref: "#/components/messages/ChunkSizeExceededError"
          - $ref: "#/components/messages/InsufficientAudioActivityError"
    subscribe:
      summary: Messages received from client to server
      message:
        oneOf:
          # Client -> Server messages
          - $ref: "#/components/messages/InputAudioChunk"

components:
  messages:
    # ===== CLIENT → SERVER MESSAGES =====

    InputAudioChunk:
      name: InputAudioChunk
      title: Input Audio Chunk
      summary: Audio data from client
      contentType: application/json
      payload:
        $ref: "#/components/schemas/InputAudioChunkPayload"

    # ===== SERVER → CLIENT MESSAGES =====

    SessionStarted:
      name: SessionStartedMessage
      title: Session Started
      summary: Sent when the transcription session is successfully started
      contentType: application/json
      payload:
        $ref: "#/components/schemas/SessionStartedPayload"

    PartialTranscript:
      name: PartialTranscriptMessage
      title: Partial Transcript
      summary: Interim transcription result (may change)
      contentType: application/json
      payload:
        $ref: "#/components/schemas/PartialTranscriptPayload"

    CommittedTranscript:
      name: CommittedTranscriptMessage
      title: Committed Transcript
      summary: Committed transcription result
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CommittedTranscriptPayload"

    CommittedTranscriptWithTimestamps:
      name: CommittedTranscriptWithTimestampsMessage
      title: Committed Transcript with Timestamps
      summary: Committed transcription result with word-level timestamps
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CommittedTranscriptWithTimestampsPayload"

    Error:
      name: ScribeErrorMessage
      title: Scribe Error Message
      summary: Error event during transcription
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeErrorPayload"

    AuthError:
      name: ScribeAuthErrorMessage
      title: Scribe Authentication Error
      summary: Authentication failed
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeAuthErrorPayload"

    QuotaExceededError:
      name: ScribeQuotaExceededErrorMessage
      title: Scribe Quota Exceeded Error
      summary: Quota exceeded
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeQuotaExceededErrorPayload"

    CommitThrottledError:
      name: ScribeCommitThrottledErrorMessage
      title: Scribe Commit Throttled Error
      summary: Commit throttled
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeCommitThrottledErrorPayload"

    TranscriberError:
      name: ScribeTranscriberErrorMessage
      title: Scribe Transcriber Error
      summary: Transcriber error
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeTranscriberErrorPayload"

    UnacceptedTermsError:
      name: ScribeUnacceptedTermsErrorMessage
      title: Scribe Unaccepted Terms Error
      summary: Unaccepted terms
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeUnacceptedTermsErrorPayload"

    RateLimitedError:
      name: ScribeRateLimitedErrorMessage
      title: Scribe Rate Limited Error
      summary: Rate limited
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeRateLimitedErrorPayload"

    InputError:
      name: ScribeInputErrorMessage
      title: Scribe Input Error
      summary: Input error
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeInputErrorPayload"

    QueueOverflowError:
      name: ScribeQueueOverflowErrorMessage
      title: Scribe Queue Overflow Error
      summary: Queue overflow
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeQueueOverflowErrorPayload"

    ResourceExhaustedError:
      name: ScribeResourceExhaustedErrorMessage
      title: Scribe Resource Exhausted Error
      summary: Resource exhausted
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeResourceExhaustedErrorPayload"

    SessionTimeLimitExceededError:
      name: ScribeSessionTimeLimitExceededErrorMessage
      title: Scribe Session Time Limit Exceeded Error
      summary: Session time limit exceeded
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeSessionTimeLimitExceededErrorPayload"

    ChunkSizeExceededError:
      name: ScribeChunkSizeExceededErrorMessage
      title: Scribe Chunk Size Exceeded Error
      summary: Chunk size exceeded
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeChunkSizeExceededErrorPayload"

    InsufficientAudioActivityError:
      name: ScribeInsufficientAudioActivityErrorMessage
      title: Scribe Insufficient Audio Activity Error
      summary: Insufficient audio activity
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ScribeInsufficientAudioActivityErrorPayload"

  schemas:
    MessageType:
      type: string
      enum:
        - session_started
        - partial_transcript
        - committed_transcript
        - committed_transcript_with_timestamps
        - error
        - auth_error
        - input_audio_chunk
      description: Types of messages that can be exchanged

    AudioFormat:
      type: string
      enum:
        - pcm_8000
        - pcm_16000
        - pcm_22050
        - pcm_24000
        - pcm_44100
        - pcm_48000
        - ulaw_8000
      description: Audio encoding format

    CommitStrategy:
      type: string
      enum:
        - manual
        - vad
      description: Strategy for committing transcriptions

    Word:
      type: object
      description: Word-level transcription data with timing information
      properties:
        text:
          type: string
          description: The transcribed word
        start:
          type: number
          description: Start time in seconds
        end:
          type: number
          description: End time in seconds
        type:
          type: string
          description: The type of word
          enum:
            - word
            - spacing
        speaker_id:
          type: string
          description: The ID of the speaker (if available)
        logprob:
          type: number
          description: Confidence score for this word
        characters:
          type: array
          description: The characters in the word
          items:
            type: string
            description: The character

    # ===== CLIENT MESSAGE PAYLOADS =====

    InputAudioChunkPayload:
      type: object
      required: [message_type, audio_base_64, commit, sample_rate]
      properties:
        message_type:
          type: string
          const: input_audio_chunk
        audio_base_64:
          type: string
          description: Base64-encoded audio data
          format: base64
        commit:
          type: boolean
          description: Whether to commit the transcription after this chunk
        sample_rate:
          type: integer
          description: Sample rate of the audio in Hz
        previous_text:
          type: string
          description: Send context to the model via base64 encoded audio or text from a previous transcription. Can only be sent alongside the first audio chunk. If sent in a subsequent chunk, an error will be returned.

    # ===== SERVER MESSAGE PAYLOADS =====

    SessionStartedPayload:
      type: object
      required: [message_type, session_id, config]
      properties:
        message_type:
          type: string
          const: session_started
        session_id:
          type: string
          description: Session ID
        config:
          type: object
          description: Configuration for the transcription session
          properties:
            sample_rate:
              type: integer
              description: Sample rate of the audio in Hz
            audio_format:
              $ref: "#/components/schemas/AudioFormat"
            language_code:
              type: string
              description: Language code in ISO 639-1 or ISO 639-3 format
            vad_commit_strategy:
              type: string
              enum:
                - manual
                - vad
              description: Strategy for committing transcriptions
            vad_silence_threshold_secs:
              type: number
              description: Silence threshold in seconds
            vad_threshold:
              type: number
              description: Threshold for voice activity detection
            min_speech_duration_ms:
              type: integer
              description: Minimum speech duration in milliseconds
            min_silence_duration_ms:
              type: integer
              description: Minimum silence duration in milliseconds
            model_id:
              type: string
              description: ID of the model to use for transcription
            disable_logging:
              type: boolean
              description: Whether to disable logging

    PartialTranscriptPayload:
      type: object
      required: [message_type, text]
      properties:
        message_type:
          type: string
          const: partial_transcript
        text:
          type: string
          description: Partial transcription text

    CommittedTranscriptPayload:
      type: object
      required: [message_type, text]
      properties:
        message_type:
          type: string
          const: committed_transcript
        text:
          type: string
          description: Committed transcription text

    CommittedTranscriptWithTimestampsPayload:
      type: object
      required: [message_type, text]
      properties:
        message_type:
          type: string
          const: committed_transcript_with_timestamps
        text:
          type: string
          description: Committed transcription text
        language_code:
          type: string
          nullable: true
          description: Detected or specified language code
        words:
          type: array
          nullable: true
          description: Word-level information with timestamps
          items:
            $ref: "#/components/schemas/Word"

    # Base error structure - used as anchor for all error payloads
    ScribeErrorBase: &ScribeErrorBase
      type: object
      required: [message_type, error]
      properties:
        error:
          type: string
          description: Error message with details

    # Generic error that can represent any error type
    ScribeErrorPayload:
      type: object
      required: [message_type, error]
      properties:
        message_type:
          type: string
          enum:
            - error
            - auth_error
            - quota_exceeded
            - commit_throttled
            - transcriber_error
            - unaccepted_terms
            - rate_limited
            - input_error
            - queue_overflow
            - resource_exhausted
            - session_time_limit_exceeded
            - chunk_size_exceeded
            - insufficient_audio_activity
          description: Type of error that occurred
        error:
          type: string
          description: Error message with details

    ScribeAuthErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: auth_error
        error:
          type: string

    ScribeQuotaExceededErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: quota_exceeded
        error:
          type: string

    ScribeCommitThrottledErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: commit_throttled
        error:
          type: string

    ScribeTranscriberErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: transcriber_error
        error:
          type: string

    ScribeUnacceptedTermsErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: unaccepted_terms
        error:
          type: string

    ScribeRateLimitedErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: rate_limited
        error:
          type: string

    ScribeInputErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: input_error
        error:
          type: string

    ScribeQueueOverflowErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: queue_overflow
        error:
          type: string

    ScribeResourceExhaustedErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: resource_exhausted
        error:
          type: string

    ScribeSessionTimeLimitExceededErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: session_time_limit_exceeded
        error:
          type: string

    ScribeChunkSizeExceededErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: chunk_size_exceeded
        error:
          type: string

    ScribeInsufficientAudioActivityErrorPayload:
      <<: *ScribeErrorBase
      properties:
        message_type:
          type: string
          const: insufficient_audio_activity
        error:
          type: string